# WebServ - Main Production Configuration
# Showcases all server capabilities with multiple ports and features

# ==================== Main Server (Port 8080) ====================
server {
    listen 8080;
    server_name localhost webserv.local;
    root ./www;
    index index.html;
    autoindex off;
    client_max_body_size 52428800;
    
    # Custom error pages
    error_page 400 /error_pages/400.html;
    error_page 403 /error_pages/403.html;
    error_page 404 /error_pages/413.html;
    error_page 405 /error_pages/405.html;
    error_page 413 /error_pages/404.html;
    error_page 500 /error_pages/500.html;
    
    # ========== Root Location ==========
    location / {
        allow_methods GET HEAD OPTIONS;
        root ./www;
        index index.html;
        autoindex off;
    }
    
    # ========== File Browser (Directory Listing) ==========
    location /browse {
        allow_methods GET HEAD OPTIONS;
        autoindex on;
    }
    
    # ========== File Upload Area ==========
    location /uploads {
        allow_methods GET POST DELETE HEAD OPTIONS;
        upload_pass ./www/uploads;
        client_max_body_size 2048576;
        autoindex on;
    }
    
    # ========== CGI Scripts ==========
    location /cgi-bin {
        allow_methods GET POST HEAD OPTIONS;
        cgi_extension .php .py .pl .rb .sh .cgi;
        autoindex on;
    }
    
    # ========== API Endpoints (Session Management) ==========
    location /api {
        allow_methods GET POST DELETE HEAD OPTIONS;
        cgi_extension .py;
    }
    
    # ========== Documentation ==========
    location /docs {
        allow_methods GET HEAD OPTIONS;
        root ./www/docs;
        index documentation.html;
        autoindex on;
    }
    
    # ========== Redirections ==========
    location /redirect {
        return 301 /index.html;
    }
    
    location /github {
        return 301 https://github.com/ValGSgit/webserv;
    }
    
    location /old-page {
        return 301 /index.html;
    }
    
    # ========== Admin Area (Restricted) ==========
    location /admin {
        allow_methods GET POST HEAD OPTIONS;
        root ./www/admin;
        autoindex off;
    }
    
    # ========== Demo Area ==========
    location /demo {
        allow_methods GET POST DELETE HEAD OPTIONS;
        root ./www/demo;
        autoindex on;
    }
    
    # ========== Games ==========
    location /games {
        allow_methods GET HEAD OPTIONS;
        root ./www;
        index games.html;
    }
}

# ==================== Alternative Server (Port 8081) ====================
server {
    listen 8080;
    server_name dev.webserv.local testing.local;
    root ./www-dev;
    index index.html;
    autoindex on;
    client_max_body_size 1048576;
    
    error_page 404 /error_pages/404.html;
    error_page 500 /error_pages/500.html;
    
    location / {
        allow_methods GET POST HEAD OPTIONS;
        root ./www-dev;
        index index.html;
        autoindex on;
    }
    
    location /test {
        allow_methods GET POST DELETE HEAD OPTIONS;
        root ./www-dev/test;
        autoindex on;
    }
}

# ==================== API Server (Port 8082) ====================
server {
    listen 8082;
    server_name api.webserv.local;
    root ./www;
    index index.html;
    autoindex off;
    client_max_body_size 10485760;
    
    location / {
        allow_methods GET POST DELETE HEAD OPTIONS;
        root ./www/api;
    }
    
    location /v1 {
        allow_methods GET POST DELETE HEAD OPTIONS;
        root ./www/api/v1;
    }
    
    location /cgi {
        allow_methods GET POST HEAD OPTIONS;
        root ./www/cgi-bin;
        cgi_extension .py .php;
    }
}
